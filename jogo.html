<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Santa Teresinha Idle</title>
<style>
body{
    margin:0;
    background:black;
    overflow:hidden;
}
canvas{
    display:block;
    margin:auto;
    background:black;
    image-rendering:pixelated;
}
</style>
</head>
<body>
<canvas id="game"></canvas>

<script>
// ==============================
// CONFIGURAÇÃO
// ==============================
const TILE = 32;
const MAP_WIDTH = 40;
const MAP_HEIGHT = 25;

const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

canvas.width = MAP_WIDTH * TILE;
canvas.height = MAP_HEIGHT * TILE;

ctx.imageSmoothingEnabled = false;


// ==============================
// IMAGENS
// ==============================

const imagens = {
    gramas: [],
    biblioteca: new Image(),
    mesa: new Image(),
    cadeira: new Image(),
    flor: new Image()
};

// carregar 5 variações de grama
for(let i = 1; i <= 5; i++){
    let img = new Image();
    img.src = `grama${i}.jpg`;
    imagens.gramas.push(img);
}

imagens.biblioteca.src = "biblioteca.png";
imagens.mesa.src = "mesa.png";
imagens.cadeira.src = "cadeira.png";
imagens.flor.src = "flor.png";


// ==============================
// GERAR MAPA DE GRAMA ALEATÓRIO
// ==============================

const mapaGrama = [];

for(let y = 0; y < MAP_HEIGHT; y++){
    mapaGrama[y] = [];
    for(let x = 0; x < MAP_WIDTH; x++){
        // sorteia qual das 5 gramas será usada nesse tile
        mapaGrama[y][x] = Math.floor(Math.random() * 5);
    }
}


// ==============================
// OBJETOS DO MAPA
// ==============================

const objetos = [

    // Biblioteca
    { tipo:"biblioteca", x:5, y:3, largura:3, altura:3 },

    // Mesa
    { tipo:"mesa", x:18, y:10, largura:2, altura:2 },

    // Cadeiras
    { tipo:"cadeira", x:17, y:11, largura:1, altura:1 },
    { tipo:"cadeira", x:20, y:11, largura:1, altura:1 },
];

// Flores aleatórias
for(let i=0;i<40;i++){
    objetos.push({
        tipo:"flor",
        x: Math.floor(Math.random()*MAP_WIDTH),
        y: Math.floor(Math.random()*MAP_HEIGHT),
        largura:1,
        altura:1
    });
}


// ==============================
// DESENHAR CHÃO
// ==============================

function desenharChao(){
    for(let y=0;y<MAP_HEIGHT;y++){
        for(let x=0;x<MAP_WIDTH;x++){

            const tipoGrama = mapaGrama[y][x];
            const img = imagens.gramas[tipoGrama];

            if(img.complete){
                ctx.drawImage(
                    img,
                    x*TILE,
                    y*TILE,
                    TILE,
                    TILE
                );
            } else {
                ctx.fillStyle = "#2ecc71";
                ctx.fillRect(
                    x*TILE,
                    y*TILE,
                    TILE,
                    TILE
                );
            }
        }
    }
}


// ==============================
// DESENHAR OBJETOS
// ==============================

function desenharObjetos(){

    // ordena por Y para dar sensação de profundidade
    objetos.sort((a,b)=> a.y - b.y);

    objetos.forEach(obj => {

        const img = imagens[obj.tipo];

        // sombra simples
        ctx.fillStyle = "rgba(0,0,0,0.2)";
        ctx.fillRect(
            obj.x*TILE,
            obj.y*TILE + obj.altura*TILE - 6,
            obj.largura*TILE,
            6
        );

        if(img && img.complete){
            ctx.drawImage(
                img,
                obj.x*TILE,
                obj.y*TILE,
                obj.largura*TILE,
                obj.altura*TILE
            );
        } else {

            if(obj.tipo=="biblioteca") ctx.fillStyle="#3498db";
            else if(obj.tipo=="mesa") ctx.fillStyle="#9b59b6";
            else if(obj.tipo=="cadeira") ctx.fillStyle="#e67e22";
            else if(obj.tipo=="flor") ctx.fillStyle="#f1c40f";

            ctx.fillRect(
                obj.x*TILE,
                obj.y*TILE,
                obj.largura*TILE,
                obj.altura*TILE
            );
        }

    });
}


// ==============================
// LOOP
// ==============================

function loop(){
    ctx.clearRect(0,0,canvas.width,canvas.height);

    desenharChao();
    desenharObjetos();

    requestAnimationFrame(loop);
}


// ==============================
// INICIAR
// ==============================

loop();

</script>
</body>
</html>
