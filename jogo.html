<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Jardim de Santa Teresinha</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  margin: 0;
  overflow: hidden;
  font-family: Arial, sans-serif;
}

#game {
  position: relative;
  width: 100vw;
  height: 100vh;
  overflow: hidden;
  background: #000;
}

#camera {
  position: absolute;
  width: 3000px;
  height: 3000px;
  left: 0;
  top: 0;
  transform: translate(0px, 0px);
}

#mapCanvas {
  position: absolute;
  left: 0;
  top: 0;
  image-rendering: pixelated;
}

#santa {
  position: absolute;
  width: 120px;
  left: 1500px;
  top: 1500px;
  transform: translate(-50%, -50%);
  pointer-events: none;
  z-index: 10;
}

.flor {
  position: absolute;
  width: 40px;
  cursor: pointer;
  z-index: 15;
}

#hud {
  position: fixed;
  top: 20px;
  left: 20px;
  background: rgba(255,255,255,0.92);
  padding: 14px;
  border-radius: 12px;
  z-index: 50;
  min-width: 180px;
}

#upgrades {
  position: fixed;
  right: 20px;
  top: 50%;
  transform: translateY(-50%);
  display: flex;
  flex-direction: column;
  gap: 12px;
  z-index: 50;
}

button {
  padding: 12px;
  border: none;
  border-radius: 10px;
  background: #7b4bb7;
  color: white;
  font-weight: bold;
  cursor: pointer;
}

button:hover {
  background: #5d3494;
}
</style>
</head>

<body>

<div id="game">
  <div id="camera">
    <canvas id="mapCanvas" width="3000" height="3000"></canvas>
    <img src="santa.png" id="santa">
  </div>
</div>

<div id="hud">
  üå∏ Flores: <span id="flores">0</span><br><br>
  üëÜ Por clique: <span id="porClique">1</span><br>
  ‚è± Auto/s: <span id="auto">0</span><br>
  üíé Valor flor: <span id="valorFlor">3</span>
</div>

<div id="upgrades">
  <button onclick="uparClique()">
    Upar Clique (üå∏ <span id="c1">10</span>)
  </button>

  <button onclick="uparAuto()">
    Upar Auto (üå∏ <span id="c2">20</span>)
  </button>

  <button onclick="uparFlor()">
    Upar Flor (üå∏ <span id="c3">30</span>)
  </button>
</div>

<script>
// ================== VARI√ÅVEIS ==================
let flores     = Number(localStorage.getItem("flores")) || 0;
let porClique  = Number(localStorage.getItem("porClique")) || 1;
let auto       = Number(localStorage.getItem("auto")) || 0;
let valorFlor  = Number(localStorage.getItem("valorFlor")) || 3;

let custoClique = 10;
let custoAuto   = 20;
let custoFlor   = 30;

const floresEl     = document.getElementById("flores");
const porCliqueEl  = document.getElementById("porClique");
const autoEl       = document.getElementById("auto");
const valorFlorEl  = document.getElementById("valorFlor");

const canvas = document.getElementById("mapCanvas");
const ctx = canvas.getContext("2d");

const TILE_SIZE = 32;
const LIB_TILE  = 64;

// ================== IMAGENS ==================
const grassTile = new Image();
grassTile.src = "tiles/ground/grass.png";

const libraryTileset = new Image();
libraryTileset.src = "tiles/library_tileset.png";

// ================== CONTROLE DE LOAD ==================
let imagensCarregadas = 0;

function imagemCarregada() {
  imagensCarregadas++;
  if (imagensCarregadas === 2) {
    desenharMapa();
  }
}

grassTile.onload = imagemCarregada;
libraryTileset.onload = imagemCarregada;

// ================== SALVAR ==================
function salvar() {
  localStorage.setItem("flores", flores);
  localStorage.setItem("porClique", porClique);
  localStorage.setItem("auto", auto);
  localStorage.setItem("valorFlor", valorFlor);
}

// ================== HUD ==================
function atualizarHUD() {
  floresEl.textContent = flores;
  porCliqueEl.textContent = porClique;
  autoEl.textContent = auto;
  valorFlorEl.textContent = valorFlor;

  document.getElementById("c1").textContent = custoClique;
  document.getElementById("c2").textContent = custoAuto;
  document.getElementById("c3").textContent = custoFlor;

  salvar();
}

// ================== MAPA ==================
function desenharGrama() {
  for (let y = 0; y < 3000; y += TILE_SIZE) {
    for (let x = 0; x < 3000; x += TILE_SIZE) {
      ctx.drawImage(grassTile, x, y, TILE_SIZE, TILE_SIZE);
    }
  }
}

function drawLibTile(tileX, tileY, mapX, mapY) {
  ctx.drawImage(
    libraryTileset,
    tileX * LIB_TILE,
    tileY * LIB_TILE,
    LIB_TILE,
    LIB_TILE,
    mapX,
    mapY,
    LIB_TILE,
    LIB_TILE
  );
}

function desenharBiblioteca() {
  let startX = 200;
  let startY = 200;

  drawLibTile(0,0, startX, startY);
  drawLibTile(1,0, startX+64, startY);
  drawLibTile(2,0, startX+128, startY);

  drawLibTile(0,2, startX, startY+64);
  drawLibTile(1,2, startX+64, startY+64);
  drawLibTile(2,2, startX+128, startY+64);

  drawLibTile(1,1, startX+64, startY+128);
}

function desenharMapa() {
  ctx.clearRect(0, 0, 3000, 3000);
  desenharGrama();
  desenharBiblioteca();
}

// ================== FLORES ==================
const camera = document.getElementById("camera");

function criarFlor() {
  if (Math.random() > 0.5) return;

  const flor = document.createElement("img");
  flor.src = "flor.png";
  flor.className = "flor";

  flor.style.left = Math.random() * 2900 + "px";
  flor.style.top  = Math.random() * 2900 + "px";

  flor.onclick = () => {
    flores += valorFlor;
    flor.remove();
    atualizarHUD();
  };

  camera.appendChild(flor);
}

setInterval(criarFlor, 2500);

// ================== CLIQUE ==================
document.getElementById("game").addEventListener("click", (e) => {
  if (e.target.classList.contains("flor")) return;
  flores += porClique;
  atualizarHUD();
});

// ================== AUTO ==================
setInterval(() => {
  flores += auto;
  atualizarHUD();
}, 1000);

// ================== UPGRADES ==================
function uparClique() {
  if (flores >= custoClique) {
    flores -= custoClique;
    porClique++;
    custoClique *= 2;
    atualizarHUD();
  }
}

function uparAuto() {
  if (flores >= custoAuto) {
    flores -= custoAuto;
    auto++;
    custoAuto *= 2;
    atualizarHUD();
  }
}

function uparFlor() {
  if (flores >= custoFlor) {
    flores -= custoFlor;
    valorFlor += 2;
    custoFlor *= 2;
    atualizarHUD();
  }
}

// ================== CAMERA ==================
let camX = 1200;
let camY = 1200;

let dragging = false;
let lastX = 0;
let lastY = 0;

document.getElementById("game").addEventListener("mousedown", (e) => {
  dragging = true;
  lastX = e.clientX;
  lastY = e.clientY;
});

document.addEventListener("mouseup", () => {
  dragging = false;
});

document.addEventListener("mousemove", (e) => {
  if (!dragging) return;

  let dx = e.clientX - lastX;
  let dy = e.clientY - lastY;

  camX -= dx;
  camY -= dy;

  camX = Math.max(0, Math.min(3000 - window.innerWidth, camX));
  camY = Math.max(0, Math.min(3000 - window.innerHeight, camY));

  camera.style.transform = `translate(${-camX}px, ${-camY}px)`;

  lastX = e.clientX;
  lastY = e.clientY;
});

atualizarHUD();
</script>

</body>
</html>
